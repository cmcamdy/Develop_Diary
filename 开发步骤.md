



### 配置ops.yaml

/home/cmcandy/code/PD/Paddle/paddle/fluid/operators/fake_quantize_op.cc
/home/cmcandy/code/PD/Paddle/paddle/fluid/pir/dialect/operator/ir/ops.yaml

```
- op: fake_channel_wise_quantize_dequantize_abs_max
  args: (Tensor x, int quant_axis = 0, int bit_length = 8)
  output: Tensor(out), Tensor(out_scale)
  infer_meta:
    func: FakeChannelWiseQuantizeInferMeta
    param: [x, quant_axis]
  kernel:
    func: fake_channel_wise_quantize_dequantize_abs_max
    data_type: x
  # backward : straight_through_estimator_grad

```
- 如果有bwd需要同时配置一下

### 配置op_compat.yaml
/home/cmcandy/code/PD/Paddle/paddle/phi/api/yaml/op_compat.yaml
```
- op : fake_channel_wise_quantize_dequantize_abs_max
  inputs :
    {x : X, bit_length : bit_length, quant_axis : quant_axis}
  outputs :
    {out : Out, out_scale : OutScale}
  extra :
    attrs : [int round_type = 1]
```

### 配置ops_api_gen.py
paddle/fluid/pir/dialect/op_generator/ops_api_gen.py
```
6.报错error: 'eager_api_XXX' was not decalred in this scope如何解决?
A: 需要将op名称添加到paddle/fluid/pir/dialect/op_generator/ops_api_gen.py中的NO_NEED_GEN_STATIC_ONLY_APIS这里同样需要保证字典序.最后，再次编译，问题消失.
```

### 配置util.cc
/home/cmcandy/code/PD/Paddle/paddle/fluid/pir/dialect/operator/utils/utils.cc
- LegacyOpList
```
8.RuntimeError: (PreconditionNotMet) op [pd_op.xxx] kernel output args defs should equal op outputs此类问题的原因是什么？怎么解决？
A:此类问题是Legacy op的kernel和phi kernel的推导机制不一致造成的。如果kernel是通过PD_REGISTER_STRUCT_KERNEL注册的，需要把他加在LegacyOpList中，单独处理。
```

<!-- 
### 检查一下定义有没有问题：

```
REGISTER_OPERATOR(
    fake_quantize_dequantize_abs_max,
    ops::FakeQuantOrWithDequantAbsMaxOp,
    ops::FakeQuantOrWithDequantAbsMaxOpMaker,
    ops::StraightThroughEstimatorMaker<paddle::framework::OpDesc>,
    ops::StraightThroughEstimatorMaker<paddle::imperative::OpBase>);
PD_REGISTER_STRUCT_KERNEL(fake_quantize_dequantize_abs_max,
                          CPU,
                          ALL_LAYOUT,
                          ops::FakeQuantizeDequantizeAbsMaxKernel,
                          float) {}

``` -->

